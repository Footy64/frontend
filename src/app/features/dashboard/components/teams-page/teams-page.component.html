<section class="teams-grid">
  <article class="card">
    <header class="card__header">
      <div>
        <h2>Créer une équipe</h2>
        <p>Ajoutez un nom et, si besoin, les identifiants des joueurs à inviter.</p>
      </div>
    </header>
    <form [formGroup]="createTeamForm" (ngSubmit)="createTeam()" class="form">
      <label class="form__field">
        <span>Nom de l'équipe</span>
        <input type="text" formControlName="name" placeholder="Ex : Les Tigres du Vendredi" />
        <small *ngIf="createTeamForm.get('name')?.touched && createTeamForm.get('name')?.hasError('required')"
          >Le nom de l'équipe est obligatoire.</small
        >
      </label>
      <label class="form__field">
        <span>Identifiants des membres (optionnel)</span>
        <textarea
          formControlName="members"
          placeholder="Saisissez les ID utilisateurs séparés par des virgules ou des espaces"
        ></textarea>
        <small>Vous pourrez toujours compléter le roster plus tard.</small>
      </label>
      <div class="form__actions">
        <button type="submit" [disabled]="isCreatingTeam">
          {{ isCreatingTeam ? 'Création...' : "Créer l'équipe" }}
        </button>
        <span *ngIf="teamFeedback as feedback" [ngClass]="feedback.type">{{ feedback.message }}</span>
      </div>
    </form>
  </article>

  <article class="card">
    <header class="card__header">
      <div>
        <h2>Mes équipes</h2>
        <p>Gérez vos rosters et gardez votre collectif à jour.</p>
      </div>
    </header>

    <ng-container *ngIf="(isLoadingTeams$ | async); else teamsContent">
      <p class="muted">Chargement des équipes...</p>
    </ng-container>
    <ng-template #teamsContent>
      <ng-container *ngIf="(teams$ | async) as teams">
        <p class="muted" *ngIf="!teams.length">Aucune équipe pour le moment.</p>
        <div *ngFor="let team of teams; trackBy: trackByTeamId" class="team-card">
          <div class="team-card__header">
            <h3>{{ team.name }}</h3>
            <span>{{ team.members.length }} membre{{ team.members.length > 1 ? 's' : '' }}</span>
          </div>
          <div class="team-card__members" *ngIf="team.members.length; else emptyMembers">
            <span *ngFor="let member of team.members" class="team-card__chip">
              {{ member.displayName || member.email }}
              <button
                type="button"
                (click)="removeMember(team, member)"
                [disabled]="isMemberActionLoading(team.id)"
              >
                Retirer
              </button>
            </span>
          </div>
          <ng-template #emptyMembers>
            <p class="muted">Aucun membre pour le moment.</p>
          </ng-template>

          <form class="member-form" [formGroup]="getMemberForm(team.id)" (ngSubmit)="addMember(team)">
            <input
              type="number"
              formControlName="userId"
              min="1"
              placeholder="ID du joueur à ajouter"
            />
            <button type="submit" [disabled]="isMemberActionLoading(team.id)">
              {{ isMemberActionLoading(team.id) ? 'Ajout...' : 'Ajouter un membre' }}
            </button>
          </form>
        </div>
      </ng-container>
    </ng-template>
  </article>
</section>
